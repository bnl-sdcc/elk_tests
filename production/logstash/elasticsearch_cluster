input {
    lumberjack {
        codec => json
        port => 5555
        ssl_certificate => "/etc/logstash/certs/lumberjack.cert"
        ssl_key => "/etc/logstash/certs/lumberjack.key"
    }
}


filter {
    mutate {
        ###remove_field => [ "@timestamp", "@version", "tags" ]
        remove_field => [ "@version", "tags" ]
    }

    mutate {
        copy => { "starttime" => "tmpindex" }
    }
    mutate {
        split => ["tmpindex", " "]
        add_field => { "index" => "%{[tmpindex][0]}" }
    }
    mutate {
        gsub => [ "index", "/", "." ]
    }
    mutate {
        replace => { "index" => "starterlog-%{index}" }
    }
    mutate {
        remove_field => [ "tmpindex" ]
    }


}


#output {
#   stdout { codec => rubydebug }
#}

output {
    elasticsearch {
        hosts => [ "monitor01.sdcc.bnl.local:9210" ]
        ###index => "jcaballero_test"
        index => "starterlog-%{+YYYY.MM.dd}"
        document_id => "%{executionhost}_%{jobid}"
        action => "update"
        doc_as_upsert => true

    } 
}

